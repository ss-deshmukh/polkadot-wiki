{% extends "base.html" %}

{# 
{% block announce %}
<div class="announcement-bar">
  <span class="announcement-text">
    Join the Web3 Summit in Berlin 16â€“18 July ðŸ‘‰
  </span>
  <a class="announcement-link" href="https://ti.to/web3-summit/web3-summit-2025" target="_blank" rel="noopener noreferrer">
    Register Here
  </a>
</div>
{{ super() }}
{% endblock %}
#}

{% block styles %}
	{{ super() }}
  <link rel="stylesheet" href="{{ 'assets/stylesheets/polkadot.css' | url }}">
  
  <style>
    /* CSS remembers theme using custom properties */
    :root {
      --theme-bg: light-dark(white, #1a1a1a);
      --theme-color: light-dark(rgba(0,0,0,0.87), #c6cfdb);
    }
    
    /* Smooth page load - hide content initially */
    html:not(.homepage):not(.page-ready) {
      background-color: var(--theme-bg) !important;
      color: var(--theme-color) !important;
    }
    
    html:not(.homepage):not(.page-ready) body {
      background-color: inherit !important;
      color: inherit !important;
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
    }
    
    /* Show content when ready */
    html:not(.homepage).page-ready body {
      background-color: inherit !important;
      color: inherit !important;
      opacity: 1;
    }
    
    /* Homepage always visible and light */
    html.homepage {
      background-color: white !important;
      color: rgba(0,0,0,0.87) !important;
    }
    
    html.homepage body {
      background-color: inherit !important;
      color: inherit !important;
      opacity: 1;
    }
  </style>
  
  <script>
    /* Set homepage class and handle user theme preference override */
    (function() {
      var htmlElement = document.documentElement;
      
      // Mark homepage immediately
      if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
        htmlElement.classList.add('homepage');
        return;
      }
      
      // Check if this is a theme switch reload
      var isThemeSwitching = sessionStorage.getItem('theme-switching');
      if (isThemeSwitching) {
        sessionStorage.removeItem('theme-switching');
        // Apply same smooth loading for theme switches
        htmlElement.classList.remove('page-ready');
      }
      
      // Check if user has overridden system preference
      try {
        var keys = ["/.__palette", window.location.pathname + ".__palette"];
        for (var i = 0; i < keys.length; i++) {
          var stored = localStorage.getItem(keys[i]);
          if (stored) {
            var data = JSON.parse(stored);
            if (data && typeof data.index === 'number') {
              // Override system preference with user choice
              if (data.index === 0) {
                htmlElement.setAttribute('data-md-color-scheme', 'default');
              } else {
                htmlElement.setAttribute('data-md-color-scheme', 'slate');
              }
              return;
            }
          }
        }
      } catch (e) {}
      
      // No user preference - let CSS handle system preference
    })();
  </script>
{% endblock %}

{% block fonts %}
  {#-
    Add Google Fonts here
  -#}
  {{ super() }}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hammersmith+One&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
{% endblock%}

{% block site_meta %}
  {{ super() }}
  <meta name="sa-verify" content="wikipolkadz4v3qypiewyql" />
  {% if page and page.meta and page.meta.keywords %}
    <meta name="keywords" content="{{ page.meta.keywords }}">
  {% endif %}
{% endblock %}

{% block site_nav %}
{#- Navigation (left menu) -#}
  {% if nav %}
    {% if page.meta and page.meta.hide %}
      {% set hidden = "hidden" if "navigation" in page.meta.hide %}
    {% endif %}
    <div
      class="md-sidebar md-sidebar--primary"
      data-md-component="sidebar"
      data-md-type="navigation"
      {{ hidden }}
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          {% include "partials/nav.html" %}
        </div>
      </div>
    </div>
  {% endif %}
  
  {#- Table of contents (TOC) -#}
  {% if "toc.integrate" not in features %}
    {% if page.meta and page.meta.hide %}
      {% set hidden = "hidden" if "toc" in page.meta.hide %}
    {% endif %}
    <div
      class="md-sidebar md-sidebar--secondary"
      data-md-component="sidebar"
      data-md-type="toc"
      {{ hidden }}
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          {#- TOC -#}
          {% include "partials/toc.html" %}
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}

{%- block container -%} 
  <div class="md-content" data-md-component="content">
    {% set class = "index-page" if not page.content %}
    <article class="md-content__inner md-typeset {{ class }}">
      {% block content %}
        {% include "partials/content.html" %}
      {% endblock %}
    </article>
  </div>
{%- endblock -%}

{% block scripts %}
  {{ super() }}
  <script>
    // Smooth page loading and theme switching
    (function() {
      // Skip homepage
      var isHomepage = window.location.pathname === '/' || window.location.pathname === '/index.html';
      if (isHomepage) return;
      
      // Show page content smoothly after everything loads
      setTimeout(function() {
        document.documentElement.classList.add('page-ready');
      }, 300);
      
      // Handle theme toggle with overlay to prevent partial changes
      var themeToggling = false;
      
      function handleThemeToggle(e) {
        if (themeToggling) return;
        themeToggling = true;
        
        // Hide page with overlay immediately
        var overlay = document.createElement('div');
        overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--theme-bg); z-index: 99999; opacity: 1;';
        document.body.appendChild(overlay);
        
        // Toggle theme and reload
        setTimeout(function() {
          var currentScheme = document.documentElement.getAttribute('data-md-color-scheme');
          var newScheme = currentScheme === 'slate' ? 'default' : 'slate';
          var newIndex = newScheme === 'default' ? 0 : 1;
          
          // Save to localStorage
          localStorage.setItem('/.__palette', JSON.stringify({index: newIndex}));
          
          // Reload page
          window.location.reload();
        }, 50);
      }
      
      // Listen for clicks on theme toggle elements
      document.addEventListener('click', function(e) {
        // Check for theme toggle button or label
        if ((e.target && e.target.getAttribute('for') && e.target.getAttribute('for').includes('__palette')) ||
            (e.target && e.target.closest('label[for*="__palette"]')) ||
            (e.target && e.target.closest('.md-header__button') && e.target.closest('.md-header__button').querySelector('label[for*="__palette"]'))) {
          e.preventDefault();
          e.stopPropagation();
          handleThemeToggle(e);
        }
      }, true);
      
      // Also listen for form changes as backup
      document.addEventListener('change', function(e) {
        if (e.target && e.target.name === '__palette') {
          e.preventDefault();
          e.stopPropagation();
          handleThemeToggle(e);
        }
      }, true);
      
      // Listen for keyboard events (space/enter on toggle)
      document.addEventListener('keydown', function(e) {
        if ((e.key === ' ' || e.key === 'Enter') && 
            e.target && e.target.getAttribute('for') && e.target.getAttribute('for').includes('__palette')) {
          e.preventDefault();
          e.stopPropagation();
          handleThemeToggle(e);
        }
      }, true);
    })();
  </script>
{% endblock %} 